<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.brewingmachine.mapper.WeChatUserMapper">

    <resultMap id="BaseResultMap" type="com.brewingmachine.entity.WeChatUser">
        <id column="id" property="id"/>
        <result column="openid" property="openid"/>
        <result column="unionid" property="unionid"/>
        <result column="session_key" property="sessionKey"/>
        <result column="nickname" property="nickname"/>
        <result column="avatar" property="avatar"/>
        <result column="gender" property="gender"/>
        <result column="city" property="city"/>
        <result column="province" property="province"/>
        <result column="country" property="country"/>
        <result column="language" property="language"/>
        <result column="user_id" property="userId"/>
        <result column="bind_time" property="bindTime"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <sql id="Base_Column_List">
        id, openid, unionid, session_key, nickname, avatar, gender, city, province, country, language, 
        user_id, bind_time, create_time, update_time
    </sql>

    <insert id="insert" parameterType="com.brewingmachine.entity.WeChatUser" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO wechat_user (openid, unionid, session_key, nickname, avatar, gender, city, province, country, 
                                language, user_id, bind_time, create_time, update_time)
        VALUES (#{openid}, #{unionid}, #{sessionKey}, #{nickname}, #{avatar}, #{gender}, #{city}, #{province}, #{country},
                #{language}, #{userId}, #{bindTime}, #{createTime}, #{updateTime})
    </insert>

    <select id="findByOpenid" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM wechat_user
        WHERE openid = #{openid}
    </select>

    <select id="findByUnionid" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM wechat_user
        WHERE unionid = #{unionid}
    </select>

    <select id="findByUserId" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM wechat_user
        WHERE user_id = #{userId}
    </select>

    <update id="updateByUserId" parameterType="map">
        UPDATE wechat_user
        <set>
            <if test="weChatUser.openid != null">openid = #{weChatUser.openid},</if>
            <if test="weChatUser.unionid != null">unionid = #{weChatUser.unionid},</if>
            <if test="weChatUser.sessionKey != null">session_key = #{weChatUser.sessionKey},</if>
            <if test="weChatUser.nickname != null">nickname = #{weChatUser.nickname},</if>
            <if test="weChatUser.avatar != null">avatar = #{weChatUser.avatar},</if>
            <if test="weChatUser.gender != null">gender = #{weChatUser.gender},</if>
            <if test="weChatUser.city != null">city = #{weChatUser.city},</if>
            <if test="weChatUser.province != null">province = #{weChatUser.province},</if>
            <if test="weChatUser.country != null">country = #{weChatUser.country},</if>
            <if test="weChatUser.language != null">language = #{weChatUser.language},</if>
            update_time = NOW()
        </set>
        WHERE user_id = #{userId}
    </update>

    <delete id="deleteByUserId">
        DELETE FROM wechat_user WHERE user_id = #{userId}
    </delete>

</mapper>
